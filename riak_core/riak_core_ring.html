<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="latin1" />
    <title>riak_core_ring (riak_core) -  - erldocs.com (Erlang Documentation)</title>
    <link type="text/css" rel="stylesheet" href="../erldocs.css" />
  </head>
  <body>

    <div id="sidebar" class="inactive">
      <input type="text" id="search" autocomplete="off"
             placeholder="press TAB to search" />
      <ul id="results"> </ul>
    </div>

    <div id="content">
      <div style="margin:0px; padding:10px 20px;">
        

<h1>riak_core_ring</h1>
<h2 class="modsummary">riak_core_ring manages a riak node's local view of partition ownership.</h2>
<div class="description">
<p>riak_core_ring manages a riak node's local view of partition ownership.
       The functions in this module revolve around use of the chstate record,
       which should be treated as opaque by other modules.  Riak nodes exchange
       instances of these records via gossip in order to converge on a common
       view of node/partition ownership.</p></div>
<div class="section"><h4>DATA TYPES</h4><span id="types"> </span>

<dl>
<dt><code>meta_entry()</code></dt>
<dd><span id="type-meta_entry"> </span>
<p>Record for each entry in #chstate.meta</p>
</dd>
<dt><code>riak_core_ring()</code></dt>
<dd><span id="type-riak_core_ring"> </span>
<p>The opaque data type used for partition ownership.</p>
</dd>
</dl></div>
<div class="functions"><h4>Functions</h4><hr  />
<div class="function">
<h3 id="all_members/1">all_members(State) -&gt; term()
</h3>


<div class="description"><span id="all_members-1"> </span>

<p>Produce a list of all nodes that own any partitions.</p>
</div></div>
<div class="function">
<h3 id="all_owners/1">all_owners(State) -&gt; term()
</h3>


<div class="description"><span id="all_owners-1"> </span>

<p>Provide all ownership information in the form of {Index,Node} pairs.</p>
</div></div>
<div class="function">
<h3 id="all_preflists/2">all_preflists(State, N) -&gt; term()
</h3>


<div class="description"><span id="all_preflists-2"> </span>

<p>Provide every preflist in the ring, truncated at N.</p>
</div></div>
<div class="function">
<h3 id="diff_nodes/2">diff_nodes(State1, State2) -&gt; term()
</h3>


<div class="description"><span id="diff_nodes-2"> </span>

<p>For two rings, return the list of owners that have differing ownership.</p>
</div></div>
<div class="function">
<h3 id="equal_rings/2">equal_rings(A, B) -&gt; term()
</h3>


<div class="description"><span id="equal_rings-2"> </span>
 </div></div>
<div class="function">
<h3 id="fresh/0">fresh() -&gt; term()
</h3>


<div class="description"><span id="fresh-0"> </span>

<p>This is used only when this node is creating a brand new cluster.</p>
</div></div>
<div class="function">
<h3 id="fresh/1">fresh(NodeName) -&gt; term()
</h3>


<div class="description"><span id="fresh-1"> </span>

<p>Equivalent to fresh/0 but allows specification of the local node name.
      Called by fresh/0, and otherwise only intended for testing purposes.</p>
</div></div>
<div class="function">
<h3 id="fresh/2">fresh(RingSize, NodeName) -&gt; term()
</h3>


<div class="description"><span id="fresh-2"> </span>

<p>Equivalent to fresh/1 but allows specification of the ring size.
      Called by fresh/1, and otherwise only intended for testing purposes.</p>
</div></div>
<div class="function">
<h3 id="get_meta/2">get_meta(Key, State) -&gt; term()
</h3>


<div class="description"><span id="get_meta-2"> </span>

<p>Return a value from the cluster metadata dict</p>
</div></div>
<div class="function">
<h3 id="index_owner/2">index_owner(State, Idx) -&gt; term()
</h3>


<div class="description"><span id="index_owner-2"> </span>

<p>Return the node that owns the given index.</p>
</div></div>
<div class="function">
<h3 id="my_indices/1">my_indices(State) -&gt; term()
</h3>


<div class="description"><span id="my_indices-1"> </span>

<p>Return all partition indices owned by the node executing this function.</p>
</div></div>
<div class="function">
<h3 id="num_partitions/1">num_partitions(State) -&gt; term()
</h3>


<div class="description"><span id="num_partitions-1"> </span>

<p>Return the number of partitions in this Riak ring.</p>
</div></div>
<div class="function">
<h3 id="owner_node/1">owner_node(State) -&gt; term()
</h3>


<div class="description"><span id="owner_node-1"> </span>

<p>Return the node that is responsible for a given chstate.</p>
</div></div>
<div class="function">
<h3 id="preflist/2">preflist(Key, State) -&gt; term()
</h3>


<div class="description"><span id="preflist-2"> </span>

<p>For a given object key, produce the ordered list of
      {partition,node} pairs that could be responsible for that object.</p>
</div></div>
<div class="function">
<h3 id="random_node/1">random_node(State) -&gt; term()
</h3>


<div class="description"><span id="random_node-1"> </span>

<p>Return a randomly-chosen node from amongst the owners.</p>
</div></div>
<div class="function">
<h3 id="random_other_index/1">random_other_index(State) -&gt; term()
</h3>


<div class="description"><span id="random_other_index-1"> </span>

<p>Return a partition index not owned by the node executing this function.
      If this node owns all partitions, return any index.</p>
</div></div>
<div class="function">
<h3 id="random_other_index/2">random_other_index(State, Exclude) -&gt; term()
</h3>


<div class="description"><span id="random_other_index-2"> </span>
 </div></div>
<div class="function">
<h3 id="random_other_node/1">random_other_node(State) -&gt; term()
</h3>


<div class="description"><span id="random_other_node-1"> </span>

<p>Return a randomly-chosen node from amongst the owners other than this one.</p>
</div></div>
<div class="function">
<h3 id="reconcile/2">reconcile(ExternState, MyState) -&gt; term()
</h3>


<div class="description"><span id="reconcile-2"> </span>

<p>Incorporate another node's state into our view of the Riak world.</p>
</div></div>
<div class="function">
<h3 id="rename_node/3">rename_node(State, OldNode, NewNode) -&gt; term()
</h3>


<div class="description"><span id="rename_node-3"> </span>

<p> Rename OldNode to NewNode in a Riak ring.</p>
</div></div>
<div class="function">
<h3 id="transfer_node/3">transfer_node(Idx, Node, MyState) -&gt; term()
</h3>


<div class="description"><span id="transfer_node-3"> </span>
 </div></div>
<div class="function">
<h3 id="update_meta/3">update_meta(Key, Val, State) -&gt; term()
</h3>


<div class="description"><span id="update_meta-3"> </span>

<p>Set a key in the cluster metadata dict</p>
</div></div></div>

<authors>
<aname> </aname>
<email> </email></authors>
      </div>
      <div id="funwrapper">
        <a id="viewfuns">View Functions</a>
        <ul id="funs"><li><a href="#all_members/1">all_members/1</a></li><li><a href="#all_owners/1">all_owners/1</a></li><li><a href="#all_preflists/2">all_preflists/2</a></li><li><a href="#diff_nodes/2">diff_nodes/2</a></li><li><a href="#equal_rings/2">equal_rings/2</a></li><li><a href="#fresh/0">fresh/0</a></li><li><a href="#fresh/1">fresh/1</a></li><li><a href="#fresh/2">fresh/2</a></li><li><a href="#get_meta/2">get_meta/2</a></li><li><a href="#index_owner/2">index_owner/2</a></li><li><a href="#my_indices/1">my_indices/1</a></li><li><a href="#num_partitions/1">num_partitions/1</a></li><li><a href="#owner_node/1">owner_node/1</a></li><li><a href="#preflist/2">preflist/2</a></li><li><a href="#random_node/1">random_node/1</a></li><li><a href="#random_other_index/1">random_other_index/1</a></li><li><a href="#random_other_index/2">random_other_index/2</a></li><li><a href="#random_other_node/1">random_other_node/1</a></li><li><a href="#reconcile/2">reconcile/2</a></li><li><a href="#rename_node/3">rename_node/3</a></li><li><a href="#transfer_node/3">transfer_node/3</a></li><li><a href="#update_meta/3">update_meta/3</a></li></ul>
      </div>
    </div>

    <script type="text/javascript">
      var CURRENT_ROOT = "../";
    </script>

    <script type="text/javascript" src="../jquery.js"></script>
    <script type="text/javascript" src="../erldocs_index.js"></script>
    <script type="text/javascript" src="../erldocs.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-59760-14']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script');
        ga.src = ('https:' == document.location.protocol ?
          'https://ssl' : 'http://www') +
          '.google-analytics.com/ga.js';
        ga.setAttribute('async', 'true');
        document.documentElement.firstChild.appendChild(ga);
      })();
    </script>
  </body>
</html>

